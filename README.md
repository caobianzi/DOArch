# DOArch - 退市期权档案库

🔱 **Delisted Options Archives (DOArch)** 是一个基于 Streamlit 的轻量级 Web 工具，用于快速查询中国已退市期权合约的历史信息。它从 Tushare 获取数据，并提供灵活的筛选功能，帮助用户准确找到所需的退市合约。




## 功能特性

- ✅ **多条件筛选**：支持按交易所（上交所/深交所/全部）、期权类型（认购/认沽/全部）、结算月、开始交易日期、最后交易日期、合约名称进行查询。
- ✅ **实时数据展示**：查询结果以表格形式清晰展示，并显示匹配的记录数量。
- ✅ **数据更新**：一键更新上交所或深交所的退市期权数据（需遵守 Tushare 调用频率限制）。
- ✅ **本地数据库**：所有数据存储于本地 SQLite 数据库中，无需额外配置数据库服务。

---

## 安装与运行

### 环境要求
- Python 3.7 或更高版本
- 推荐使用虚拟环境（如 `venv` 或 `conda`）

### 安装步骤
1. **克隆仓库**
   ```bash
   git clone https://github.com/caobianzi/DOArch.git
   cd DOArch
   ```

2. **安装依赖**
   ```bash
   pip install -r requirements.txt
   ```
   > 如果尚未生成 `requirements.txt`，请手动安装以下包：
   > `streamlit pandas tushare sqlalchemy`

3. **配置 Tushare Token**
   - 访问 [Tushare Pro](https://tushare.pro/) 注册并获取你的 token。
   - 打开主程序文件（例如 `app.py`），找到以下代码行：
     ```python
     token = 'test'   # 请替换为你的 Tushare token
     ```
   - 将 `'test'` 替换为你的真实 token。

4. **启动应用**
   ```bash
   streamlit run app.py
   ```
   应用将自动在浏览器中打开，默认地址为 `http://localhost:8501`。

---

## 使用指南

### 主界面查询
界面顶部提供了六个筛选条件：
- **交易所**：选择 `SSE`（上交所）、`SZSE`（深交所）或 `all`（全部）。
- **期权类型**：选择 `C`（认购）、`P`（认沽）或 `all`（全部）。
- **结算月**：输入格式为 `YYYYMM`，例如 `202401`。
- **开始交易日期**：输入格式为 `YYYYMMDD`，用于筛选开始交易日期 >= 该日期的合约。
- **最后交易日期**：输入格式为 `YYYYMMDD`，用于筛选最后交易日期 <= 该日期的合约。
- **合约名称**：输入部分名称进行模糊匹配（例如输入“50ETF”）。

点击 **“已退市期权合约查询”** 按钮执行查询，结果将显示在下方的表格中，同时会统计符合条件的合约数量，并显示各 ETF 期权的最早上市日期提示。

### 数据更新
页面底部有一个可折叠区域 **“数据更新中。。。”**，包含两个更新按钮：
- **更新上交所[退市]期权合约信息**
- **更新深交所[退市]期权合约信息**

点击任一按钮，程序会从 Tushare 获取最新退市期权数据，并替换本地数据库中的对应表。由于 Tushare 免费版有访问频率限制（两次请求需间隔 1 分钟），点击更新后应用会启动一个 60 秒的倒计时进度条，完成后会有气球动画提示。

> 注意：更新操作会覆盖现有数据，请谨慎使用。

---

## 项目结构

```
DOArch/
├── DOArch/                  # 数据库目录（自动创建）
│   └── doarch.db            # SQLite 数据库文件
├── app.py                   # 主程序入口（即提供的代码）
├── requirements.txt         # Python 依赖列表（可选）
└── README.md                # 本文档
```

---

## 数据来源与版权

- 所有期权数据均来自 [Tushare](https://tushare.pro/) 金融大数据平台，使用前请确保已阅读并同意 Tushare 的服务条款。
- 本工具仅用于个人学习与研究，不保证数据的绝对准确性和完整性。
- 项目作者：**樊沛涵** · [GitHub @caobianzi](https://github.com/caobianzi)  
  © 2025 保留部分权利。

---

## 注意事项

1. **Tushare Token**：必须替换为有效的 token，否则数据更新功能无法使用。
2. **更新频率限制**：Tushare 对普通用户有每分钟最多访问 60 次的限制，但本工具已内置 60 秒倒计时，请勿手动快速点击更新按钮。
3. **首次运行**：如果没有数据库文件，查询结果可能为空，请先通过更新按钮获取数据。
4. **数据库路径**：代码中数据库路径基于项目根目录生成，请确保项目结构保持默认。

---

## 如何贡献

欢迎通过 Issue 或 Pull Request 提出改进建议或报告问题。贡献前请确保代码风格与现有代码保持一致，并添加必要的注释。

---

## 许可证

本项目采用 MIT 许可证。详情请参阅 [LICENSE](LICENSE) 文件（如未提供，则默认遵循 MIT 协议）。
